<div>
    <!-- Filter Bar -->
    @if(filters.length > 0 || config.searchPlaceholder) {
    <div class="mb-3">
        <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
            @if(filters.length > 0) {
            <div class="d-flex align-items-center gap-2 flex-wrap">
                @for(filter of filters; track filter.id) {
                    @if(filter.value && filter.value !== 'All') {
                        <span class="filter-pill filter-pill-selected" (click)="filter.removable && onFilterRemove(filter.id)">
                            {{ filter.label }}
                            @if(filter.removable) {
                                <mat-icon class="filter-close-icon">close</mat-icon>
                            }
                        </span>
                    } @else {
                        <span class="filter-pill filter-pill-dropdown" (click)="onFilterClick(filter)">
                            {{ filter.label }}
                            <mat-icon class="filter-dropdown-icon">keyboard_arrow_down</mat-icon>
                        </span>
                    }
                }
            </div>
            }
            
            <!-- Search Bar -->
            @if(config.searchPlaceholder) {
            <div class="search-container">
                <mat-icon class="search-icon">search</mat-icon>
                <input 
                    type="text" 
                    class="search-input" 
                    [placeholder]="config.searchPlaceholder"
                    [value]="searchValue"
                    (input)="onSearchChange($event)"
                    (keyup.enter)="onSearchButtonClick()">
                <button class="search-button" (click)="onSearchButtonClick()" type="button">
                    <mat-icon>search</mat-icon>
                </button>
            </div>
            }
        </div>
    </div>
    }

    <!-- Table -->
    <div class="table-container">
        <table mat-table [dataSource]="sortedData" class="assets-table" [style.min-width]="config.minWidth || '1400px'">
            @for(column of config.columns; track column.key) {
            <ng-container [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef [style.width]="column.width">
                    @if(column.sortable !== false) {
                    <div class="sortable-header" (click)="onSort(column.key)">
                        {{ column.header }}
                        <mat-icon class="sort-icon" [ngClass]="getSortIconClass(column.key)">
                            {{ getSortIcon(column.key) }}
                        </mat-icon>
                    </div>
                    } @else {
                    {{ column.header }}
                    }
                </th>
            <td mat-cell *matCellDef="let row" [style.width]="column.width">
                @switch(column.cellType) {
                    @case('icon') {
                        <div class="analyze-icon-container" [style.background-color]="column.iconBgColor || 'var(--color-blue-light)'">
                            <mat-icon class="analyze-icon" [style.color]="column.iconColor || 'var(--color-blue-dark)'">
                                {{ column.iconName || 'bar_chart' }}
                            </mat-icon>
                        </div>
                    }
                    @case('two-line') {
                        <div class="two-line-cell">
                            <div class="line-primary">{{ getCellValue(row, column.primaryField || '') }}</div>
                            <div class="line-secondary">{{ getCellValue(row, column.secondaryField || '') }}</div>
                        </div>
                    }
                    @case('link') {
                        <div class="two-line-cell">
                            <div class="line-primary">{{ getCellValue(row, column.primaryField || '') }}</div>
                            <a [href]="getCellValue(row, column.linkField || '')" 
                               target="_blank" 
                               class="line-link">
                                {{ getCellValue(row, column.linkField || '') }}
                            </a>
                        </div>
                    }
                    @case('badge') {
                        <span class="badge" 
                              [ngClass]="getBadgeClass(column.badgeColor)"
                              [style.background-color]="column.badgeColor"
                              [style.color]="column.badgeTextColor">
                            {{ getCellValue(row, column.badgeField || '') }}
                        </span>
                    }
                    @case('badge-with-subtext') {
                        <div class="badge-cell">
                            <span class="badge" 
                                  [ngClass]="getBadgeClass(column.badgeColor)"
                                  [style.background-color]="column.badgeColor"
                                  [style.color]="column.badgeTextColor">
                                {{ getCellValue(row, column.badgeField || '') }}
                            </span>
                            <div class="line-secondary mt-1">{{ getCellValue(row, column.subtextField || '') }}</div>
                        </div>
                    }
                    @case('text-with-color') {
                        <div class="two-line-cell">
                            <div class="line-primary" [ngClass]="getTextColorClass(column.textColor)">
                                {{ getCellValue(row, column.primaryField || '') }}
                            </div>
                            <div class="line-secondary" [ngClass]="getSecondaryTextColorClass(column.textColor)">
                                {{ getCellValue(row, column.secondaryField || '') }}
                            </div>
                        </div>
                    }
                    @default {
                        <div>{{ getCellValue(row, column.primaryField || column.key) }}</div>
                    }
                }
            </td>
        </ng-container>
        }

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
</div>

    <!-- Filter Modal -->
    <app-filter-modal
        [filters]="filters"
        [isOpen]="isFilterModalOpen"
        (close)="onFilterModalClose()"
        (apply)="onFilterApply($event)"
        (reset)="onFilterReset()">
    </app-filter-modal>
</div>
