<div class="pm-dashboard-container">
  <!-- Left: title + main content (is side pe header se gap rahega) -->
  <div class="dashboard-left">
    <div class="dashboard-header">
      <h1 class="dashboard-title">Executive Dashboard</h1>
    </div>
  </div>
</div>
<div class="pm-dashboard-container">
  <!-- Left: title + main content (is side pe header se gap rahega) -->
  <div class="dashboard-left">
    <div class="dashboard-content">
      <!-- Main Content Area -->
      <div class="main-content">
        <!-- KPI Cards -->
        <div class="kpi-cards-grid">
          <!-- Card 1: Digital Experience Score (Highlighted) -->
          <div class="kpi-card kpi-card-highlighted">
            <div class="kpi-card-content kpi-card-highlighted-content">
              <div class="kpi-highlighted-header">
                <h1 class="kpi-value-white">
                  {{ digitalExperienceScore | number: "1.0-2" }}%
                </h1>
                <span class="kpi-badge-change" [ngClass]="
                    getDigitalScoreBadgeValue() >= 0
                      ? 'kpi-badge-positive'
                      : 'kpi-badge badge-status-danger'
                  ">
                  {{ getDigitalScoreBadgeValue() >= 0 ? "+" : ""
                  }}{{ getDigitalScoreBadgeValue() | number: "1.0-2" }}%
                </span>
              </div>
              <h5 class="kpi-title-white">Digital Experience Score</h5>
              <p class="kpi-subtitle-white">
                National average target score is 90%
              </p>
              <div class="kpi-divider-white"></div>
              <div class="kpi-footer-white">
                <a routerLink="/dashboard" class="kpi-link-white">View Assets With Low Digital Experience Score </a>
              </div>
            </div>
          </div>

          <!-- Card 2: Total Assets Being Monitored -->
          <div class="kpi-card">
            <div class="kpi-card-content">
              <div class="kpi-card-icon-wrap" [ngClass]="getKpiIconBgClass('totalAssets', totalAssetsBeingMonitored)">
                <img src="/Images/PM-Dashboard/arrow-tr.svg" alt="" class="kpi-card-corner-icon" />
              </div>
              <h1 class="kpi-value">{{ totalAssetsBeingMonitored }}</h1>
              <h5 class="kpi-title">Total Assets Being Monitored</h5>
              <p class="kpi-subtitle">
                Across {{ totalMinistries }} Ministries
              </p>
              <div class="kpi-divider"></div>
              <div class="kpi-footer">
                <a routerLink="/dashboard" class="kpi-link">View Assets That Meet Compliance Standards </a>
              </div>
            </div>
          </div>

          <!-- Card 3: Digital Assets Are Offline -->
          <div class="kpi-card">
            <div class="kpi-card-content">
              <div class="kpi-card-icon-wrap" [ngClass]="getKpiIconBgClass('offline', digitalAssetsOffline)">
                <img [src]="
                    digitalAssetsOffline === 0
                      ? '/Images/PM-Dashboard/Variant3.svg'
                      : '/Images/PM-Dashboard/Offline Digital Assets.svg'
                  " alt="" class="kpi-card-corner-icon" />
              </div>
              <h1 class="kpi-value">{{ digitalAssetsOffline }}</h1>
              <h5 class="kpi-title">Digital Assets Are Offline</h5>
              <p class="kpi-subtitle">
                Last Checked: {{ getLastCheckedText() }}
              </p>
              <div class="kpi-divider"></div>
              <div class="kpi-footer">
                <a routerLink="/dashboard" [queryParams]="{ currentStatus: 'Down' }" class="kpi-link">View Assets
                  Currently Down </a>
              </div>
            </div>
          </div>

          <!-- Card 4: Ministries meet Compliance standards -->
          <div class="kpi-card">
            <div class="kpi-card-content">
              <div class="kpi-card-icon-wrap"
                [ngClass]="getKpiIconBgClass('compliance', ministriesMeetComplianceStandards)">
                <img src="/Images/PM-Dashboard/carbon_security.svg" alt="" class="kpi-card-corner-icon" />
              </div>
              <h1 class="kpi-value">{{ ministriesMeetComplianceStandards }}</h1>
              <h5 class="kpi-title">Ministries Meet Compliance Standards</h5>
              <p class="kpi-subtitle">
                Ministries With Compliance Score &gt; {{ complianceThreshold }}%
              </p>
              <div class="kpi-divider"></div>
              <div class="kpi-footer">
                <a routerLink="/ministries" class="kpi-link">View Non-Compliant Ministries </a>
              </div>
            </div>
          </div>

          <!-- Card 5: Active Incidents -->
          <div class="kpi-card">
            <div class="kpi-card-content">
              <div class="kpi-card-icon-wrap kpi-icon-bg-incidents">
                <img [src]="
                    activeIncidents === 0
                      ? '/Images/PM-Dashboard/Variant3.svg'
                      : '/Images/PM-Dashboard/siren.svg'
                  " alt="" class="kpi-card-corner-icon" />
              </div>
              <h1 class="kpi-value">{{ activeIncidents }}</h1>
              <h5 class="kpi-title">Active Incidents</h5>
              <p class="kpi-subtitle">Currently Unresolved Incidents</p>
              <div class="kpi-divider"></div>
              <div class="kpi-footer">
                <a routerLink="/incidents" class="kpi-link">View {{ resolvedIncidentsLast30Days }} Incidents Resolved In
                  Last 30 Days </a>
              </div>
            </div>
          </div>

          <!-- Card 6: Assets are vulnerable -->
          <div class="kpi-card">
            <div class="kpi-card-content">
              <div class="kpi-card-icon-wrap" [ngClass]="getKpiIconBgClass('vulnerable', assetsAreVulnerable)">
                <img [src]="
                    assetsAreVulnerable === 0
                      ? '/Images/PM-Dashboard/Variant3.svg'
                      : '/Images/PM-Dashboard/error.svg'
                  " alt="" class="kpi-card-corner-icon" />
              </div>
              <h1 class="kpi-value">{{ assetsAreVulnerable }}</h1>
              <h5 class="kpi-title">Assets Are Vulnerable</h5>
              <p class="kpi-subtitle">
                Assets With Security Index &lt;{{ securityThreshold }}
              </p>
              <div class="kpi-divider"></div>
              <div class="kpi-footer">
                <a routerLink="/dashboard" [queryParams]="{ riskIndex: 'LOW RISK' }" class="kpi-link">View Assets With
                  High Security Compliance </a>
              </div>
            </div>
          </div>
        </div>

        <!-- Tables Section -->
        <div class="tables-section">
          <!-- Table 1: Bottom 5 Ministries by Citizen Impact -->
          <div class="table-wrapper-custom">
            <h3 class="table-title">Bottom 5 Ministries by Compliance</h3>
            <app-reusable-table [config]="bottomMinistriesTableConfig" [filters]="[]"
              [totalItems]="bottomMinistriesData.length"></app-reusable-table>
          </div>

          <!-- Table 2: Top 5 Ministries Ranked by Compliance -->
          <div class="table-wrapper-custom">
            <h3 class="table-title">Top 5 Ministries Ranked by Compliance</h3>
            <app-reusable-table [config]="topMinistriesTableConfig" [filters]="[]"
              [totalItems]="topMinistriesData.length"></app-reusable-table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Sidebar - tiles same as left (glass, 24px radius) -->
  <div class="sidebar">
    <!-- Tile: Total Assets Monitored -->
    <div class="sidebar-tile">
      <h3 class="section-title">Total Assets Monitored</h3>
      <div class="performance-indices">
        <div class="index-item" *ngFor="let index of performanceIndices">
          <div class="index-header">
            <span class="index-label">{{ index.label }}</span>
            <span class="index-value">{{ index.value }}%</span>
          </div>
          <div class="index-progress-container" [style.background-color]="getIndexBgColor(index.value)">
            <div class="index-progress-bar" [style.width.%]="index.value"
              [style.background-color]="getIndexColor(index.value)"></div>
          </div>
        </div>
      </div>

      <!-- Tile: Insights -->
      <!-- <div class="sidebar-section">
      <h3 class="section-title">Traffic Overview</h3>
      <div class="traffic-overview">
        <div class="traffic-item">
          <span class="traffic-label">Total Visits:</span>
          <span class="traffic-value">{{
            getTrafficDisplay(totalVisits)
          }}</span>
        </div>
        <div class="traffic-item">
          <span class="traffic-label">Unique Visitors:</span>
          <span class="traffic-value">{{
            getTrafficDisplay(uniqueVisitors)
          }}</span>
        </div>
      </div>
    </div> -->
      <br>
      <br>
      <br>
      <div class="sidebar-tile sidebar-tile-last" (mouseenter)="onInsightsMouseEnter()"
        (mouseleave)="onInsightsMouseLeave()">
        <div class="insights-header">
          <h3 class="section-title">Insights</h3>
          <div class="insights-navigation">
            <button class="nav-button" type="button" (click)="previousInsight()"
              [disabled]="currentInsightIndex() === 0" aria-label="Previous insight">
              <mat-icon>keyboard_arrow_left</mat-icon>
            </button>
            <button class="nav-button" type="button" (click)="nextInsight()"
              [disabled]="currentInsightIndex() === insights.length - 1" aria-label="Next insight">
              <mat-icon>keyboard_arrow_right</mat-icon>
            </button>
          </div>
        </div>
        <div class="insights-card">
          <div class="insights-content">
            <div class="insight-value">{{ currentInsight().value }}</div>
            <div class="insight-subtitle">{{ currentInsight().subtitle }}</div>
            <p class="insight-description">{{ currentInsight().description }}</p>
          </div>
          <div class="insights-dots">
            <span *ngFor="let insight of insights; let i = index" class="dot"
              [class.active]="i === currentInsightIndex()" (click)="goToInsight(i)"
              [attr.aria-label]="'Insight ' + (i + 1) + ' of ' + insights.length">
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
