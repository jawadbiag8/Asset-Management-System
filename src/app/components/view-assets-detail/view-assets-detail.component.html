<div class="container-fluid p-4">
  <!-- Breadcrumb Navigation -->
  <app-reusable-breadcrum
    [breadcrumbs]="[
      { label: 'Dashboard', path: '/dashboard' },
      { label: 'Ministry', path: '/assets/by-ministry' },
      { label: assetDetails.ministry || 'Ministry', path: ministryId ? `/ministry-detail?ministryId=${ministryId}` : '/ministry-detail' },
      { label: 'Health Dashboard' },
    ]"
  ></app-reusable-breadcrum>

  <!-- Health Dashboard Card -->
  <div class="card shadow-sm mt-4">
    <!-- Page Title -->
    <div class="card-body">
      <!-- Left: Asset Details -->
      <div class="row g-4 align-items-center">
        <div class="col-12 col-md-5">
          <div class="left-section">
            <h1 class="fw-bold">Health Dashboard</h1>

            <div class="info-row">
              <div class="info-item">
                <label class="text-uppercase text-muted small fw-medium mb-1 d-block">URL</label>
                <a [href]="'https://' + assetDetails.url" target="_blank" class="link">
                  {{ assetDetails.url }}
                </a>
              </div>
              <div class="info-item">
                <label class="text-uppercase text-muted small fw-medium mb-1 d-block">MINISTRY</label>
                <span class="d-block fw-semibold">{{ assetDetails.ministry }}</span>
              </div>
              <div class="info-item">
                <label class="text-uppercase text-muted small fw-medium mb-1 d-block">DEPARTMENT</label>
                <span class="d-block fw-semibold">{{ assetDetails.department || 'N/A' }}</span>
              </div>
            </div>

            <div class="analyze-button-container">
              <button class="btn btn-analyze" (click)="onAnalyze()">Analyze</button>
            </div>
          </div>
        </div>

        <!-- Middle: Status Badges Group -->
        <div class="col-12 col-md-5">
          <div class="border rounded p-4">
            <div class="row g-3">
              <div class="col-12 col-sm-4 border-end border-sm-end-0  pb-3 pb-sm-0 pe-sm-3">
                <div class="center">
                  <label class="text-uppercase text-muted small fw-medium mb-2">CITIZEN IMPACT
                    LEVEL</label>
                  <span class="badge"
                    [ngClass]="getBadgeClass(getBadgeColor(assetDetails.citizenImpactLevel, 'citizenImpact'))"
                    [style.background-color]="getBadgeColor(assetDetails.citizenImpactLevel, 'citizenImpact')"
                    [style.color]="getBadgeTextColor(assetDetails.citizenImpactLevel, 'citizenImpact')">
                    {{ assetDetails.citizenImpactLevel || 'UNKNOWN' }}
                  </span>
                </div>
              </div>
              <div class="col-12 col-sm-4 border-end border-sm-end-0  pb-3 pb-sm-0 pe-sm-3">
                <div class="center">
                  <label class="text-uppercase text-muted small fw-medium mb-2">CURRENT HEALTH</label>
                  <span class="badge"
                    [ngClass]="getBadgeClass(getBadgeColor(assetDetails.currentHealth, 'health'))"
                    [style.background-color]="getBadgeColor(assetDetails.currentHealth, 'health')"
                    [style.color]="getBadgeTextColor(assetDetails.currentHealth, 'health')">
                    {{ assetDetails.currentHealth || 'UNKNOWN' }}
                  </span>
                </div>
              </div>
              <div class="col-12 col-sm-4">
                <div class="center">
                  <label class="text-uppercase text-muted small fw-medium mb-2">RISK EXPOSURE INDEX</label>
                  <span class="badge"
                    [ngClass]="getBadgeClass(getBadgeColor(assetDetails.riskExposureIndex, 'risk'))"
                    [style.background-color]="getBadgeColor(assetDetails.riskExposureIndex, 'risk')"
                    [style.color]="getBadgeTextColor(assetDetails.riskExposureIndex, 'risk')">
                    {{ assetDetails.riskExposureIndex || 'UNKNOWN' }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Current Status Box -->
        <div class="col-12 col-md-2">
          <div class="d-flex flex-column gap-3 ms-auto" style="max-width: 220px;">
            <div class="rounded p-3" [ngClass]="getStatusBoxClass(assetDetails.currentStatus)">
              <div class="center">
                <label class="text-uppercase text-muted small fw-medium mb-2">CURRENT STATUS</label>
                <span class="fw-semibold"
                  [ngClass]="getStatusTextClass(assetDetails.currentStatus)">
                  {{ assetDetails.currentStatus || 'Unknown' }}
                </span>
              </div>
            </div>
            <div class="d-flex justify-content-between gap-2">
              <label class="text-uppercase text-muted small fw-medium mb-1">LAST OUTAGE</label>
              <span class="">{{ assetDetails.lastOutage || 'N/A' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary KPI Cards -->
  <div class="kpi-cards-section">
    <div class="kpi-card">
      <div class="kpi-value">{{ summaryKpis.citizenHappiness }}%</div>
      <div class="kpi-label">Digital Experience Score</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value">{{ summaryKpis.overallCompliance }}%</div>
      <div class="kpi-label">Overall Compliance Metric</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value">{{ summaryKpis.openIncidents }}</div>
      <div class="kpi-label">Open incidents</div>
    </div>
    <div class="kpi-card">
      <div class="kpi-value">{{ summaryKpis.highSeverityOpenIncidents }}</div>
      <div class="kpi-label">High severity open incidents</div>
    </div>
  </div>

  <!-- Standards Compliance Overview -->
  <div class="standards-section">
    <h2 class="section-title">Compliance Overview</h2>
    <div class="section-separator"></div>
    <div class="standards-cards">
      <div class="standard-card" *ngFor="let standard of standardsCompliance">
        <div class="standard-name">{{ standard.name }}</div>
        <span class="status-badge" [ngClass]="getStatusBadgeClass(standard.status)">
          {{ standard.status }}
        </span>
      </div>
    </div>
  </div>

  <!-- Incidents Section (only for this asset via getIncidentByAssetId) -->
  <div class="incidents-section" *ngIf="assetId">
    <h2 class="section-title">Incidents</h2>
    <div class="section-separator"></div>
    <app-active-incidents
      [showHeader]="false"
      [showBreadcrumb]="false"
      [showAddButton]="false"
      [assetId]="assetId"
      [initialQueryParams]="incidentQueryParams"
      (queryParamsChange)="onIncidentQueryParamsChange($event)">
    </app-active-incidents>
  </div>

  <!-- Ownership & Accountability Section -->
  <div class="ownership-section">
    <h2 class="section-title">Ownership & Accountability</h2>
    <div class="section-separator"></div>
    <div class="ownership-cards">
      <div class="ownership-card">
        <div class="ownership-label">OWNER NAME</div>
        <div class="ownership-value">{{ ownership.ownerName }}</div>
      </div>
      <div class="ownership-card">
        <div class="ownership-label">OWNER EMAIL</div>
        <div class="ownership-value">{{ ownership.ownerEmail }}</div>
      </div>
      <div class="ownership-card">
        <div class="ownership-label">OWNER CONTACT</div>
        <div class="ownership-value">{{ ownership.ownerContact }}</div>
      </div>
      <div class="ownership-card">
        <div class="ownership-label">TECHNICAL OWNER NAME</div>
        <div class="ownership-value" [ngClass]="{'not-assigned': !ownership.technicalOwnerName}">
          {{ ownership.technicalOwnerName || 'Not Assigned' }}
        </div>
      </div>
      <div class="ownership-card">
        <div class="ownership-label">EMAIL</div>
        <div class="ownership-value">{{ ownership.technicalOwnerEmail || 'NA' }}</div>
      </div>
      <div class="ownership-card">
        <div class="ownership-label">CONTACT</div>
        <div class="ownership-value">{{ ownership.technicalOwnerContact || 'NA' }}</div>
      </div>
    </div>
  </div>
</div>
